<?xml version="1.0" encoding="UTF-8"?>
<!-- **************************************************************************
.... For copyright and licensing terms, see the file named COPYING.
.... **************************************************************************
.-->
<?xml-stylesheet href="docbook-xml.css" type="text/css"?>

<refentry id="framebuffer-dump">

<refmeta xmlns:xi="http://www.w3.org/2001/XInclude">
<refentrytitle>framebuffer-dump</refentrytitle>
<manvolnum>1</manvolnum>
<refmiscinfo class="manual">user commands</refmiscinfo>
<refmiscinfo class="source">nosh</refmiscinfo>
<xi:include href="version.xml" />
</refmeta>

<refnamediv>
<refname>framebuffer-dump</refname>
<refpurpose>dump the graphics mode contents of the framebuffer to a PBM, PGM, or PPM file</refpurpose>
</refnamediv>

<refsynopsisdiv>
<cmdsynopsis>
<command>framebuffer-dump</command>
<arg choice='req'><replaceable>fbname</replaceable></arg>
</cmdsynopsis>
</refsynopsisdiv>

<refsection><title>Description</title>

<para>
<command>framebuffer-dump</command> opens the framebuffer device named <arg choice='plain'><replaceable>fbname</replaceable></arg> and dumps its contents as a <ulink url="https://netpbm.sourceforge.net/doc/pbm.html">Portable Bitmap</ulink> (PBM), a <ulink url="https://netpbm.sourceforge.net/doc/pgm.html">Portable Grayscale</ulink> (PGM), or a <ulink url="https://netpbm.sourceforge.net/doc/ppm.html">Portable Pixmap</ulink> (PPM) file to its standard output.
The output is suitable for input straight in to many netpbm tools, such as (for one example) the <citerefentry><refentrytitle>pbmtojpeg</refentrytitle><manvolnum>1</manvolnum></citerefentry> utility.
</para>

<para>
On Linux framebuffer device filenames take the form <filename>/dev/fb<replaceable>number</replaceable></filename>.
On FreeBSD framebuffer device filenames take the form <filename>/dev/ttyv<replaceable>hexnumber</replaceable></filename>.
On NetBSD framebuffer device filenames take the form <filename>/dev/tty[EF]<replaceable>number</replaceable></filename>.
</para>

<para>
Only graphic modes can be dumped; text modes cannot be.
Of those graphic modes, only linear or "packed pixel" modes can be dumped.
i.e.  <command>framebuffer-dump</command> will not attempt to dump the framebuffer if <citerefentry><refentrytitle>vidcontrol</refentrytitle><manvolnum>8</manvolnum></citerefentry> has set an old "planar" VGA mode.
</para>

<note>
Most Super VGA cards (sic!) are capable of a linear mode equivalent to the old "planar" VGA mode, with the same resolution, and those modes should be used instead.
As a beneficial side-effect, dropping use of the "planar" video modes allows <emphasis>other</emphasis> softwares that use framebuffers to take a code path where they no longer require direct I/O instruction access to the display hardware from application mode, and no longer require superuser privileges, just read+write access to the framebuffer device.
</note>

<para>
In Direct Colour modes, the framebuffer contents are output as a PPM file.
In Indexed Colour (i.e. palette colour) modes, the framebuffer contents are output as a PPM file, mapping the colours to RGB values using the same (default) palette as used by <citerefentry><refentrytitle>console-terminal-emulator</refentrytitle><manvolnum>1</manvolnum></citerefentry>.
In Monochrome modes, the framebuffer contents are output as PBM file.
All three use the relevant textual "plain" file format rather than the binary "raw" format.
</para>

<note>
Strictly speaking the stock FreeBSD <citerefentry><refentrytitle>vga</refentrytitle><manvolnum>4</manvolnum></citerefentry> framebuffer driver in FreeBSD is capable of Monochome modes.
But they are supplanted by <citerefentry><refentrytitle>vesa</refentrytitle><manvolnum>4</manvolnum></citerefentry> which usually does not advertise any.
</note>

<note>
32-bit TrueColour, 24-bit TrueColour, 16-bit, and 15-bit modes are all Direct Colour systems.
They all store RGB values directly in the framebuffer memory.
</note>

</refsection>

<refsection><title>Security</title>

<para>
The ability to dump the framebuffer is the ability to see whatever a user using that framebuffer is doing.
</para>

<para>
For this reason, FreeBSD does not permit access to the framebuffer unless the <filename>/dev/ttyv<replaceable>number</replaceable></filename> device is the currently active kernel virtual terminal being rendered upon it.
Otherwise, since logged-in users have owner access to their kernel virtual terminals, one logged-in user could see the framebuffer of another logged-in user's virtual terminal.
The obscure error that it returns to indicate that the framebuffer is not the active kernel virtual terminal device is "Invalid parameter".
</para>
<note>
The currently active kernel virtual terminal can be set by hotkeys or with the <citerefentry><refentrytitle>console-multiplexor-control</refentrytitle><manvolnum>1</manvolnum></citerefentry> utility.
See <citerefentry><refentrytitle>syscons</refentrytitle><manvolnum>4</manvolnum></citerefentry> and <citerefentry><refentrytitle>vt</refentrytitle><manvolnum>4</manvolnum></citerefentry>.
</note>

</refsection>

<refsection><title>History</title>

<para>
Early development versions of this utility output Indexed Colour as a PGM file.
This proved to be not useful.
</para>

</refsection>

<refsection><title>Author</title>
<para><author><personname><firstname>Jonathan</firstname> <surname>de Boyne Pollard</surname></personname></author></para>
</refsection>

</refentry>
